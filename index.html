<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>4-Week Paycheck Tracker</title>
<style>
  :root {
    --bg:#0f1115; --panel:#171923; --text:#e6e8f0;
    --text-dim:#a7b0c0; --good:#1db954; --bad:#ff5876;
  }
  body{margin:0; font-family:system-ui; background:var(--bg); color:var(--text);}
  .wrap{max-width:500px; margin:20px auto; padding:0 16px;}
  h1,h2{margin:4px 0;}
  .card{background:var(--panel); padding:14px; margin-bottom:16px; border-radius:12px;}
  .row{display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid #2a2f3a;}
  .row:last-child{border-bottom:none;}
  .toggle{width:40px;height:20px;position:relative;appearance:none;background:#252a36;border-radius:20px;outline:none;cursor:pointer;}
  .toggle::after{content:"";position:absolute;top:2px;left:2px;width:16px;height:16px;background:#8a93a8;border-radius:50%;transition:.2s;}
  .toggle:checked{background:#1db954;}
  .toggle:checked::after{left:22px;background:#fff;}
  .progress{height:8px;background:#242938;border-radius:8px;margin-top:10px;overflow:hidden;}
  .progress > i{display:block;height:100%;background:#1db954;width:0%;}
  .hidden{display:none;}
  .week-nav{display:flex;justify-content:space-between;margin-bottom:10px;}
  button{background:#7c5cff;color:#fff;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
<div class="wrap">
<h1>Paycheck Tracker</h1>

<div class="week-nav">
  <button id="prevWeek">← Prev</button>
  <span id="weekLabel">Week</span>
  <button id="nextWeek">Next →</button>
</div>

<section id="weeks"></section>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";

// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyC7ubmyUmeCAun50g-AUUOHiuwpGAys2HM",
  authDomain: "budget-tracker-1eea7.firebaseapp.com",
  projectId: "budget-tracker-1eea7",
  storageBucket: "budget-tracker-1eea7.appspot.com",
  messagingSenderId: "579597071031",
  appId: "1:579597071031:web:f30c2d42cc57268707d332"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const TOGGLE_DOC = doc(db, "toggles", "paychecks");

// ===== Data =====
const PAYCHECKS = [
  { date:'2025-09-19', amount:2017, bills:[
      {id:'kicks', name:'Kicks', amt:472},
      {id:'progressive', name:'Progressive', amt:300},
      {id:'rogue', name:'Rogue', amt:700},
      {id:'fridge', name:'Fridge', amt:60},
      {id:'penasco', name:'Peñasco', amt:45},
      {id:'vegas', name:'Vegas', amt:51},
      {id:'amazon', name:'Amazon', amt:50}
    ]
  },
  { date:'2025-09-26', amount:650, bills:[
      {id:'hawaiian', name:'Hawaiian Airlines', amt:65},
      {id:'city', name:'City of Phoenix', amt:60},
      {id:'chase', name:'Chase', amt:125},
      {id:'frontier', name:'Frontier', amt:65}
    ]
  },
  { date:'2025-10-03', amount:2017, bills:[
      {id:'house', name:'House Payment', amt:950},
      {id:'qs3064', name:'QS 3064', amt:100},
      {id:'centurylink', name:'Century Link', amt:70},
      {id:'tmobile', name:'T-Mobile', amt:368},
      {id:'hoa', name:'HOA', amt:160}
    ]
  },
  { date:'2025-10-10', amount:650, bills:[
      {id:'walmart', name:'Walmart', amt:75},
      {id:'qs5989', name:'QS 5989', amt:100},
      {id:'capitalone', name:'Capital One', amt:189}
    ]
  }
];

// ===== Helpers =====
function money(n){ return '$'+Number(n).toLocaleString(undefined,{maximumFractionDigits:0}); }

let state = {};
let currentWeek = 0;
const weeksEl = document.getElementById('weeks');
const weekLabel = document.getElementById('weekLabel');

// ===== Functions =====
async function loadState(){
  try{
    const snap = await getDoc(TOGGLE_DOC);
    state = snap.exists() ? snap.data() : {};
  }catch(e){console.warn("Error reading Firestore:",e);}
}

function renderWeek(index){
  weeksEl.innerHTML='';
  const week = PAYCHECKS[index];
  weekLabel.textContent = `Week ${index+1} - ${week.date}`;
  let totalPaid = 0;
  const card = document.createElement('div');
  card.className='card';
  week.bills.forEach(b=>{
    const checked = state[b.id]?'checked':'';
    if(state[b.id]) totalPaid+=b.amt;
    const row = document.createElement('div');
    row.className='row';
    row.innerHTML=`<span>${b.name} (${money(b.amt)})</span>
      <input type="checkbox" class="toggle" data-id="${b.id}" ${checked}>`;
    card.appendChild(row);
  });
  const remaining = week.amount - totalPaid;
  const progress = Math.round((totalPaid/week.amount)*100);
  const progressBar = document.createElement('div');
  progressBar.className='progress';
  progressBar.innerHTML=`<i style="width:${progress}%;"></i>`;
  const totals = document.createElement('div');
  totals.style.marginTop='8px';
  totals.innerHTML=`Paid: ${money(totalPaid)} | Remaining: ${money(remaining)}`;
  card.appendChild(totals);
  card.appendChild(progressBar);
  weeksEl.appendChild(card);
}

// ===== Event Handlers =====
document.addEventListener('change', async e=>{
  if(e.target.matches('.toggle')){
    const id=e.target.dataset.id;
    state[id]=e.target.checked;
    try{await setDoc(TOGGLE_DOC,{[id]:state[id]},{merge:true});}
    catch(err){console.warn("Error saving toggle:",err);}
    renderWeek(currentWeek);
  }
});

document.getElementById('prevWeek').addEventListener('click',()=>{
  if(currentWeek>0){currentWeek--; renderWeek(currentWeek);}
});
document.getElementById('nextWeek').addEventListener('click',()=>{
  if(currentWeek<PAYCHECKS.length-1){currentWeek++; renderWeek(currentWeek);}
});

// ===== Init =====
signInAnonymously(auth).catch(console.error);
onAuthStateChanged(auth, user=>{
  if(user){
    loadState().then(()=>{
      // Auto-select current week based on date
      const today = new Date();
      currentWeek = PAYCHECKS.findIndex(p=>new Date(p.date) <= today) || 0;
      renderWeek(currentWeek);
    });
  } else console.warn("Not signed in");
});
</script>
</body>
</html>