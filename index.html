<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ’° Paydate Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background:#1a1c28; color:#eee; padding:20px; }
    h2 { margin-top:30px; }
    .paydate { border:1px solid #333; padding:12px; border-radius:10px; margin-bottom:16px; background:#242837; }
    .bill { display:flex; justify-content:space-between; padding:4px 0; }
    .progress { height:8px; background:#444; border-radius:5px; margin-top:8px; }
    .progress i { display:block; height:100%; background:#4caf50; border-radius:5px; }
    .paid { text-decoration:line-through; color:#999; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // === Firebase config ===
    const firebaseConfig = {
      apiKey: "AIzaSyC7ubmyUmeCAun50g-AUUOHiuwpGAys2HM",
      authDomain: "budget-tracker-1eea7.firebaseapp.com",
      projectId: "budget-tracker-1eea7",
      storageBucket: "budget-tracker-1eea7.appspot.com",
      messagingSenderId: "579",
      appId: "1:579:web:example"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // === Data (your paydates + bills) ===
    const PAYDATES = [
      {
        date:"2025-08-22", amount:2017, bills:[
          {id:"kicks", name:"Kicks", amt:472},
          {id:"progressive", name:"Progressive", amt:300},
          {id:"rogue", name:"Rogue", amt:700},
          {id:"fridge", name:"Fridge", amt:60},
          {id:"penasco", name:"PeÃ±asco", amt:45},
          {id:"vegas", name:"Vegas", amt:51},
          {id:"amazon", name:"Amazon Prime", amt:50}
        ]
      },
      {
        date:"2025-08-29", amount:650, bills:[
          {id:"hawaiian", name:"Hawaiian Airlines", amt:65},
          {id:"phoenix", name:"City of Phoenix", amt:60},
          {id:"chase", name:"Chase", amt:125},
          {id:"frontier", name:"Frontier", amt:65}
        ]
      },
      {
        date:"2025-09-05", amount:2017, bills:[
          {id:"house", name:"House Payment", amt:950},
          {id:"qs3064", name:"Quicksilver 3064", amt:100},
          {id:"centurylink", name:"Century Link", amt:70},
          {id:"tmobile", name:"T-Mobile", amt:368},
          {id:"hoa", name:"HOA", amt:160}
        ]
      },
      {
        date:"2025-09-12", amount:650, bills:[
          {id:"walmart", name:"Walmart", amt:75},
          {id:"qs5989", name:"Quicksilver 5989", amt:100},
          {id:"capitalone", name:"Capital One", amt:189}
        ]
      }
    ];

    const state = {};

    function money(n){ return "$"+n.toFixed(2); }

    // === Render all paydates ===
    function renderAll() {
      const container = document.getElementById("paydates");
      container.innerHTML = "";

      PAYDATES.forEach(pd=>{
        let totalPaid=0;
        const paydateDiv = document.createElement("div");
        paydateDiv.className="paydate";

        let html = `<h3>${new Date(pd.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} â€” Pay: ${money(pd.amount)}</h3>`;

        pd.bills.forEach(b=>{
          const toggleId = `${pd.date}_${b.id}`;
          const checked = state[toggleId] ? "checked" : "";
          if(state[toggleId]) totalPaid += b.amt;

          html += `<div class="bill">
            <label class="${state[toggleId]?'paid':''}">
              <input type="checkbox" data-id="${toggleId}" ${checked}> ${b.name}
            </label>
            <span>${money(b.amt)}</span>
          </div>`;
        });

        // progress: 100% only if all bills are paid
        const allPaid = pd.bills.every(b => state[`${pd.date}_${b.id}`]);
        const pct = allPaid ? 100 : Math.round((totalPaid/pd.amount)*100);

        html += `<div class="progress"><i style="width:${pct}%"></i></div>`;
        paydateDiv.innerHTML = html;
        container.appendChild(paydateDiv);
      });

      attachToggleListeners();
    }

    // === Toggle checkboxes ===
    function attachToggleListeners() {
      document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
        cb.onchange = async (e)=>{
          const id = e.target.getAttribute("data-id");
          state[id] = e.target.checked;
          await saveState(id, state[id]);
          renderAll();
        };
      });
    }

    // === Firebase save/load ===
    async function saveState(id, val) {
      try {
        await setDoc(doc(db,"toggles",id),{checked:val});
      } catch(e){ console.error("Save failed", e); }
    }
    async function loadState() {
      for (const pd of PAYDATES){
        for (const b of pd.bills){
          const id = `${pd.date}_${b.id}`;
          const snap = await getDoc(doc(db,"toggles",id));
          if(snap.exists()) state[id] = snap.data().checked;
        }
      }
      renderAll();
    }

    loadState();
  </script>
</head>
<body>
  <h1>ðŸ’° Paydate Tracker</h1>
  <div id="paydates"></div>
  <h2>ðŸ“… Month Overview Coming Nextâ€¦</h2>
</body>
</html>
